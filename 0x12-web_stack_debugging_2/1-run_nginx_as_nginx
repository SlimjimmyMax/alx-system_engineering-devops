#!/usr/bin/env bash
# This script configures Nginx to run as the nginx user and listen on all active IPs on port 8080.

# Stop nginx if it's already running
nginx -s stop

# Edit the nginx configuration file to specify the user as nginx
sed -i 's/^user .*/user nginx;/g' /etc/nginx/nginx.conf

# Update the nginx configuration to listen on port 8080 for all IPs
sed -i 's/^    listen 80;/    listen 8080 default_server;/g' /etc/nginx/sites-available/default

# Restart nginx service
service nginx restart

# Verify nginx is running as nginx user and listening on port 8080
ps auxff | grep ngin[x]
nc -z 0 8080
